<div class="container mt-5">
  <div class="row">
    <div class="col-md-12">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Team Comparison</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <% teams.forEach((team, index) => { %>
            <div class="col-md-6">
              <div
                class="card <%= index === 0 ? 'border-primary' : 'border-danger' %>"
              >
                <div
                  class="card-header <%= index === 0 ? 'bg-primary text-white' : 'bg-danger text-white' %>"
                >
                  <h4 class="mb-0"><%= team.name %></h4>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <h5>Total Goals</h5>
                      <h2><%= team.total_goals || 0 %></h2>
                    </div>
                    <div class="col-md-6 mb-3">
                      <h5>Total Attempts</h5>
                      <h2><%= team.total_attempts || 0 %></h2>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <h5>Accuracy</h5>
                      <div class="progress" style="height: 30px">
                        <div
                          class="progress-bar <%= index === 0 ? 'bg-primary' : 'bg-danger' %>"
                          role="progressbar"
                          style="
                            width: <%= (team.accuracy * 100) .toFixed(1) %>%;
                          "
                          aria-valuenow="<%= (team.accuracy * 100).toFixed(1) %>"
                          aria-valuemin="0"
                          aria-valuemax="100"
                        >
                          <%= (team.accuracy * 100).toFixed(1) %>%
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <a
                    href="/teams/dashboard/<%= team.name.toLowerCase().replace(/[^a-z0-9\\s-]/g, '').replace(/\\s+/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '') %>"
                    class="btn btn-sm <%= index === 0 ? 'btn-primary' : 'btn-danger' %>"
                    >View Team</a
                  >
                </div>
              </div>
            </div>
            <% }); %>
          </div>

          <!-- Comparison Chart -->
          <div class="mt-5">
            <h4 class="mb-3">Performance Comparison</h4>
            <canvas id="comparisonChart" height="300"></canvas>
          </div>

          <div class="mt-4">
            <a href="/teams/compare" class="btn btn-primary"
              >Compare Different Teams</a
            >
            <a href="/teams/browse" class="btn btn-outline-secondary ms-2"
              >Browse All Teams</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('comparisonChart').getContext('2d');
    const teams = <%- JSON.stringify(teams) %>;

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Goals', 'Attempts', 'Accuracy (%)'],
        datasets: teams.map((team, index) => ({
          label: team.name,
          data: [
            team.total_goals || 0,
            team.total_attempts || 0,
            (team.accuracy * 100).toFixed(1)
          ],
          backgroundColor: index === 0 ? 'rgba(54, 162, 235, 0.5)' : 'rgba(255, 99, 132, 0.5)',
          borderColor: index === 0 ? 'rgba(54, 162, 235, 1)' : 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }))
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  });
</script>

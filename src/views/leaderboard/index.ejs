<div class="container mt-5">
  <div class="row">
    <div class="col-md-12">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Striker Splash Leaderboard</h3>
        </div>
        <div class="card-body">
          <!-- View Toggle -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="btn-group w-100" role="group">
                <a href="/leaderboard" class="btn btn-primary">Player Leaderboard</a>
                <a href="/leaderboard?view=teams" class="btn btn-outline-primary">Team Leaderboard</a>
              </div>
            </div>
          </div>
          
          <!-- Filters -->
          <div class="row mb-4">
            <div class="col-md-2">
              <label for="gender-filter" class="form-label">Gender</label>
              <select class="form-select" id="gender-filter">
                <option value="all" <%= filters.gender === 'all' ? 'selected' : '' %>>All</option>
                <option value="male" <%= filters.gender === 'male' ? 'selected' : '' %>>Men</option>
                <option value="female" <%= filters.gender === 'female' ? 'selected' : '' %>>Women</option>
              </select>
            </div>
            <div class="col-md-2">
              <label for="age-filter" class="form-label">Age Bracket</label>
              <select class="form-select" id="age-filter">
                <option value="all" <%= filters.ageGroup === 'all' ? 'selected' : '' %>>All Ages</option>
                <% ageBrackets.forEach(bracket => { %>
                  <option value="<%= bracket.name %>" <%= filters.ageGroup === bracket.name ? 'selected' : '' %>><%= bracket.name %></option>
                <% }); %>
              </select>
            </div>
            <div class="col-md-3">
              <label for="district-filter" class="form-label">District</label>
              <input type="text" class="form-control" id="district-filter" placeholder="Filter by district" value="<%= filters.residence !== 'all' ? filters.residence : '' %>">
            </div>
            <div class="col-md-3">
              <label for="time-filter" class="form-label">Time Range</label>
              <select class="form-select" id="time-filter">
                <option value="all" <%= filters.timeRange === 'all' ? 'selected' : '' %>>All Time</option>
                <option value="day" <%= filters.timeRange === 'day' ? 'selected' : '' %>>Today</option>
                <option value="week" <%= filters.timeRange === 'week' ? 'selected' : '' %>>This Week</option>
                <option value="month" <%= filters.timeRange === 'month' ? 'selected' : '' %>>This Month</option>
                <option value="year" <%= filters.timeRange === 'year' ? 'selected' : '' %>>This Year</option>
              </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
              <button type="button" class="btn btn-primary w-100" id="apply-filters">
                <i class="bi bi-funnel"></i> Apply Filters
              </button>
            </div>
          </div>
          
          <!-- Reset Filters Button -->
          <div class="row mb-4">
            <div class="col-12">
              <button type="button" class="btn btn-outline-secondary" id="reset-filters">
                <i class="bi bi-x-circle"></i> Reset Filters
              </button>
            </div>
          </div>
          
          <!-- Leaderboard Table -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Name</th>
                  <th>District</th>
                  <th>Gender</th>
                  <th>Age Group</th>
                  <th>Goals</th>
                  <th>Attempts</th>
                  <th>Referees</th>
                  <th>Percentile</th>
                </tr>
              </thead>
              <tbody id="leaderboard-data">
                <% if (leaderboard && leaderboard.length > 0) { %>
                  <% leaderboard.forEach((player, index) => { %>
                    <tr>
                      <td><%= index + 1 %></td>
                      <td><%= player.name %></td>
                      <td><%= player.residence %></td>
                      <td><%= player.gender || 'Unknown' %></td>
                      <td><%= player.age_group %></td>
                      <td><%= player.total_goals %></td>
                      <td><%= player.total_attempts %></td>
                      <td><small><%= player.referees || 'Unknown' %></small></td>
                      <td>
                        <% if (player.percentile <= 10) { %>
                          <span class="badge bg-danger">Top 10%</span>
                        <% } else if (player.percentile <= 25) { %>
                          <span class="badge bg-warning">Top 25%</span>
                        <% } else if (player.percentile <= 50) { %>
                          <span class="badge bg-info">Top 50%</span>
                        <% } else { %>
                          <span class="badge bg-secondary"><%= player.percentile %>%</span>
                        <% } %>
                      </td>
                    </tr>
                  <% }); %>
                <% } else { %>
                  <tr>
                    <td colspan="9" class="text-center">No data available</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Staff on Duty -->
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0">Today's Staff on Duty</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <% if (staffOnDuty && staffOnDuty.length > 0) { %>
              <% staffOnDuty.forEach(staff => { %>
                <div class="col-md-4 mb-3">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5 class="card-title"><%= staff.name %></h5>
                      <p class="card-text">
                        <span class="badge 
                          <%= staff.role === 'cashier' ? 'bg-primary' : 
                             staff.role === 'referee' ? 'bg-success' : 
                             'bg-info' %>">
                          <%= staff.role.charAt(0).toUpperCase() + staff.role.slice(1) %>
                        </span>
                      </p>
                    </div>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <div class="col-12">
                <p class="text-center">No staff on duty today</p>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Apply filters button
    document.getElementById('apply-filters').addEventListener('click', function() {
      const gender = document.getElementById('gender-filter').value;
      const ageGroup = document.getElementById('age-filter').value;
      const residence = document.getElementById('district-filter').value;
      const timeRange = document.getElementById('time-filter').value;
      
      // Build query string
      let queryParams = [];
      if (gender !== 'all') queryParams.push(`gender=${gender}`);
      if (ageGroup !== 'all') queryParams.push(`ageGroup=${ageGroup}`);
      if (residence) queryParams.push(`residence=${residence}`);
      if (timeRange !== 'all') queryParams.push(`timeRange=${timeRange}`);
      
      // Redirect with filters
      window.location.href = `/leaderboard?${queryParams.join('&')}`;
    });
    
    // Reset filters button
    document.getElementById('reset-filters').addEventListener('click', function() {
      window.location.href = '/leaderboard';
    });
  });
</script>
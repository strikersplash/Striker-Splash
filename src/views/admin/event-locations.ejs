<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="bi bi-speedometer2"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/staff">
              <i class="bi bi-people"></i> Manage Staff
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/players">
              <i class="bi bi-person-badge"></i> Manage Players
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/sales-reports">
              <i class="bi bi-graph-up"></i> Sales Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/tickets">
              <i class="bi bi-ticket-perforated"></i> Ticket Management
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/raffle">
              <i class="bi bi-trophy"></i> Daily Raffle
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/admin/event-locations">
              <i class="bi bi-calendar-event"></i> Event Locations
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div
        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
      >
        <h1 class="h2">Event Locations</h1>
      </div>

      <!-- Event Locations -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">Event Locations</h5>
        </div>
        <div class="card-body">
          <h5>Add New Event Location</h5>
          <form
            action="/admin/event-locations/location/add"
            method="POST"
            class="mb-4"
          >
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="name" class="form-label">Location Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  name="name"
                  placeholder="Location Name"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="address" class="form-label">Address</label>
                <input
                  type="text"
                  class="form-control"
                  id="address"
                  name="address"
                  placeholder="Address"
                  required
                />
              </div>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label for="startDate" class="form-label">Start Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="startDate"
                  name="startDate"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="endDate" class="form-label">End Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="endDate"
                  name="endDate"
                  required
                />
              </div>
              <!-- Max Kicks is always 5 - hidden input -->
              <input type="hidden" id="maxKicks" name="maxKicks" value="5" />
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-12">
                <label for="description" class="form-label">Description</label>
                <textarea
                  class="form-control"
                  id="description"
                  name="description"
                  placeholder="Event description (optional)"
                  rows="3"
                ></textarea>
              </div>
              <!-- Tickets Required is always 1 - hidden input -->
              <input
                type="hidden"
                id="ticketsRequired"
                name="ticketsRequired"
                value="1"
              />
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-plus-circle fs-6"></i> Add Event
              </button>
            </div>
          </form>

          <hr />
          <h5 class="mt-4">Existing Event Locations</h5>
          <div class="table-responsive mt-3">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Dates</th>
                  <th>Ticket Requirement</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% if (locations && locations.length > 0) { %> <%
                locations.forEach(location => { %>
                <tr>
                  <td>
                    <%= location.name %><br />
                    <small class="text-muted"><%= location.address %></small>
                  </td>
                  <td>
                    <%= new Date(location.start_date).toLocaleDateString() %> to
                    <%= new Date(location.end_date).toLocaleDateString() %>
                  </td>
                  <td>
                    1 ticket per kick<br />
                    <small class="text-muted">Max 5 kicks</small>
                  </td>
                  <td>
                    <form
                      action="/admin/event-locations/location/delete/<%= location.id %>"
                      method="POST"
                      class="d-inline"
                      onsubmit="return confirm('Are you sure you want to delete this event? This will also remove all player registrations.')"
                    >
                      <button type="submit" class="btn btn-sm btn-danger">
                        <i class="bi bi-trash fs-6"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                <% }) %> <% } else { %>
                <tr>
                  <td colspan="5" class="text-center">
                    No event locations added yet
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <script>
        // Set default dates for event creation
        document.addEventListener("DOMContentLoaded", function () {
          const today = new Date();
          const tomorrow = new Date();
          tomorrow.setDate(today.getDate() + 1);

          // Format dates as YYYY-MM-DD
          const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}-${month}-${day}`;
          };

          document.getElementById("startDate").value = formatDate(today);
          document.getElementById("endDate").value = formatDate(tomorrow);
        });
      </script>
    </div>
  </div>
</div>

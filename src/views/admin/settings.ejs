<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="bi bi-speedometer2"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/staff">
              <i class="bi bi-people"></i> Manage Staff
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/players">
              <i class="bi bi-person-badge"></i> Manage Players
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/tickets">
              <i class="bi bi-ticket-perforated"></i> Ticket Management
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/staff-duty">
              <i class="bi bi-calendar-check"></i> Staff on Duty
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/raffle">
              <i class="bi bi-trophy"></i> Daily Raffle
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/reports">
              <i class="bi bi-graph-up"></i> Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/admin/settings">
              <i class="bi bi-gear"></i> Settings
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Settings</h1>
      </div>

      <!-- Event Locations -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">Event Locations</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive mb-4">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% if (locations && locations.length > 0) { %>
                  <% locations.forEach(location => { %>
                    <tr>
                      <td><%= location.name %></td>
                      <td><%= location.address %></td>
                      <td>
                        <a href="/admin/settings/event-locations/<%= location.id %>/delete" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this location?')">Delete</a>
                      </td>
                    </tr>
                  <% }); %>
                <% } else { %>
                  <tr>
                    <td colspan="3" class="text-center">No locations found</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          
          <h5>Add New Location</h5>
          <form action="/admin/settings/event-locations" method="POST">
            <div class="row">
              <div class="col-md-5">
                <div class="mb-3">
                  <label for="name" class="form-label">Name</label>
                  <input type="text" class="form-control" id="name" name="name" required>
                </div>
              </div>
              <div class="col-md-5">
                <div class="mb-3">
                  <label for="address" class="form-label">Address</label>
                  <input type="text" class="form-control" id="address" name="address" required>
                </div>
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <div class="mb-3 w-100">
                  <button type="submit" class="btn btn-primary w-100">Add Location</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- System Settings -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">System Settings</h5>
        </div>
        <div class="card-body">
          <form id="system-settings-form">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="site-name" class="form-label">Site Name</label>
                  <input type="text" class="form-control" id="site-name" name="siteName" value="Striker Splash">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="contact-email" class="form-label">Contact Email</label>
                  <input type="email" class="form-control" id="contact-email" name="contactEmail" value="info@strikersplash.com">
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="kick-price" class="form-label">Kick Price (BZD)</label>
                  <input type="number" class="form-control" id="kick-price" name="kickPrice" value="1" min="0.01" step="0.01">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="min-kicks" class="form-label">Minimum Kicks for Competition</label>
                  <input type="number" class="form-control" id="min-kicks" name="minKicks" value="5" min="1">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <button type="submit" class="btn btn-primary">Save Settings</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Database Management -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Database Management</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">Backup Database</h5>
                  <p class="card-text">Create a backup of the entire database.</p>
                  <button type="button" class="btn btn-primary" id="backup-db">Create Backup</button>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">Reset Database</h5>
                  <p class="card-text">Reset the database to its initial state. This will delete all data!</p>
                  <button type="button" class="btn btn-danger" id="reset-db">Reset Database</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // System settings form
    document.getElementById('system-settings-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const data = {};
      
      for (const [key, value] of formData.entries()) {
        data[key] = value;
      }
      
      // Send data to server
      fetch('/admin/settings/system', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Settings saved successfully');
        } else {
          alert(`Error: ${data.message}`);
        }
      })
      .catch(error => {
        console.error('Error saving settings:', error);
        alert('Error saving settings. Please try again.');
      });
    });
    
    // Backup database button
    document.getElementById('backup-db').addEventListener('click', function() {
      if (confirm('Are you sure you want to create a database backup?')) {
        window.location.href = '/admin/backup-db';
      }
    });
    
    // Reset database button
    document.getElementById('reset-db').addEventListener('click', function() {
      if (confirm('WARNING: This will delete ALL data in the database! Are you absolutely sure?')) {
        if (prompt('Type "RESET" to confirm database reset:') === 'RESET') {
          window.location.href = '/admin/reset-db';
        }
      }
    });
  });
</script>
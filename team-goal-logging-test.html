<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Goal Logging Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
      }
      .card-header {
        background-color: #f5f5f5;
        margin: -15px;
        margin-bottom: 15px;
        padding: 10px;
        border-bottom: 1px solid #ddd;
      }
      .badge {
        padding: 5px 10px;
        border-radius: 3px;
      }
      .bg-primary {
        background-color: blue;
        color: white;
      }
      .btn {
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        border: none;
      }
      .btn-primary {
        background-color: blue;
        color: white;
      }
      .row {
        display: flex;
        margin-bottom: 10px;
      }
      .col {
        flex: 1;
      }
      .team-card {
        width: 300px;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        width: 60%;
        border-radius: 5px;
      }
      .modal-header {
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 10px;
      }
      .modal-body {
        margin-bottom: 15px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input,
      select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
      }
      .close {
        float: right;
        cursor: pointer;
        font-size: 20px;
      }
      .results {
        margin-top: 30px;
        border: 1px solid #ddd;
        padding: 15px;
        background-color: #f9f9f9;
      }
      .log {
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>Team Goal Logging Test</h1>

    <h2>Test Team</h2>
    <div class="card team-card" data-team-id="123">
      <div class="card-header">
        <h3>Test FC</h3>
        <small>Captain: John Doe</small>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col">
            <strong>Team Score:</strong>
            <span class="badge bg-primary" id="team-score-123">0</span>
          </div>
          <div class="col">
            <strong>Total Kicks:</strong>
            <span id="team-kicks-123">0/55</span>
          </div>
        </div>
        <div>
          <button
            type="button"
            class="btn btn-primary"
            onclick="viewTeamMembers('123')"
          >
            View Team Members
          </button>
        </div>
      </div>
    </div>

    <!-- Log Goals Modal -->
    <div id="logGoalsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Log Goals</h2>
          <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
          <form id="logGoalsForm">
            <input
              type="hidden"
              id="participantId"
              name="participantId"
              value="456"
            />
            <input
              type="hidden"
              id="competitionId"
              name="competitionId"
              value="789"
            />
            <input type="hidden" id="teamId" name="teamId" value="123" />
            <input
              type="hidden"
              id="playerName"
              name="playerName"
              value="Test Player"
            />

            <div class="form-group">
              <label for="kicksUsed">Kicks Used:</label>
              <input
                type="number"
                id="kicksUsed"
                name="kicksUsed"
                min="1"
                max="5"
                value="3"
                required
              />
            </div>

            <div class="form-group">
              <label for="goalsScored">Goals Scored:</label>
              <input
                type="number"
                id="goalsScored"
                name="goalsScored"
                min="0"
                max="5"
                value="2"
                required
              />
            </div>

            <button type="button" onclick="submitTest()">Submit</button>
          </form>
        </div>
      </div>
    </div>

    <button type="button" onclick="runTests()">Run All Tests</button>

    <div class="results">
      <h2>Test Results</h2>
      <div class="log" id="testLog"></div>
    </div>

    <script>
      // Test functions
      function updateTeamAfterGoals(teamId, goals, kicksUsed) {
        log(`Running updateTeamAfterGoals(${teamId}, ${goals}, ${kicksUsed})`);

        // Update team score
        const teamScoreElement = document.getElementById(
          `team-score-${teamId}`
        );
        if (teamScoreElement) {
          const currentScore = parseInt(teamScoreElement.textContent) || 0;
          const newScore = currentScore + goals;
          teamScoreElement.textContent = newScore;
          log(`Updated score: ${currentScore} → ${newScore}`);
        } else {
          log(`ERROR: Score element not found for team ${teamId}`);
        }

        // Update total kicks
        const teamKicksElement = document.getElementById(
          `team-kicks-${teamId}`
        );
        if (teamKicksElement) {
          const kicksText = teamKicksElement.textContent;
          const currentKicks = parseInt(kicksText.split("/")[0]) || 0;
          const maxKicks = kicksText.split("/")[1];
          const newKicks = currentKicks + kicksUsed;
          teamKicksElement.textContent = `${newKicks}/${maxKicks}`;
          log(
            `Updated kicks: ${currentKicks} → ${newKicks} out of ${maxKicks}`
          );
        } else {
          log(`ERROR: Kicks element not found for team ${teamId}`);
        }
      }

      function updateTeamMaxKicks(teamId, maxKicks) {
        log(`Running updateTeamMaxKicks(${teamId}, ${maxKicks})`);

        const teamKicksElement = document.getElementById(
          `team-kicks-${teamId}`
        );
        if (teamKicksElement) {
          const kicksText = teamKicksElement.textContent;
          const currentKicks = parseInt(kicksText.split("/")[0]) || 0;
          teamKicksElement.textContent = `${currentKicks}/${maxKicks}`;
          log(`Updated max kicks: /? → /${maxKicks}`);
        } else {
          log(`ERROR: Kicks element not found for team ${teamId}`);
        }
      }

      // UI functions
      function viewTeamMembers(teamId) {
        log(`Opening modal for team ${teamId}`);
        document.getElementById("logGoalsModal").style.display = "block";
        document.getElementById("teamId").value = teamId;
      }

      function closeModal() {
        document.getElementById("logGoalsModal").style.display = "none";
      }

      function submitTest() {
        const participantId = document.getElementById("participantId").value;
        const competitionId = document.getElementById("competitionId").value;
        const teamId = document.getElementById("teamId").value;
        const kicksUsed = parseInt(document.getElementById("kicksUsed").value);
        const goalsScored = parseInt(
          document.getElementById("goalsScored").value
        );

        log("Form submitted with values:");
        log(`  participantId: ${participantId}`);
        log(`  competitionId: ${competitionId}`);
        log(`  teamId: ${teamId}`);
        log(`  kicksUsed: ${kicksUsed}`);
        log(`  goalsScored: ${goalsScored}`);

        // Mock successful submission
        const data = {
          participantId: parseInt(participantId),
          competitionId: parseInt(competitionId),
          teamId: parseInt(teamId),
          kicksUsed: kicksUsed,
          goals: goalsScored,
        };

        log('Processing "successful" submission...');
        updateTeamAfterGoals(data.teamId, data.goals, data.kicksUsed);

        closeModal();
      }

      // Test runners
      function runTests() {
        clearLog();
        log("=== Starting Tests ===");

        const teamId = "123";

        // Test 1: Basic UI existence
        log("\n[Test 1] Checking UI elements");
        const scoreElement = document.getElementById(`team-score-${teamId}`);
        const kicksElement = document.getElementById(`team-kicks-${teamId}`);

        log(`Score element exists: ${scoreElement !== null}`);
        log(`Kicks element exists: ${kicksElement !== null}`);

        if (scoreElement) {
          log(`Initial score value: "${scoreElement.textContent}"`);
        }

        if (kicksElement) {
          log(`Initial kicks value: "${kicksElement.textContent}"`);
        }

        // Test 2: updateTeamAfterGoals function
        log("\n[Test 2] Testing updateTeamAfterGoals function");
        const originalScore = scoreElement ? scoreElement.textContent : "";
        const originalKicks = kicksElement ? kicksElement.textContent : "";

        // Add 2 goals with 3 kicks
        updateTeamAfterGoals(teamId, 2, 3);

        // Test 3: updateTeamMaxKicks function
        log("\n[Test 3] Testing updateTeamMaxKicks function");
        updateTeamMaxKicks(teamId, 55);

        // Reset values
        setTimeout(() => {
          if (scoreElement) scoreElement.textContent = originalScore;
          if (kicksElement) kicksElement.textContent = originalKicks;
          log("\n[Cleanup] Reset values to original state");
        }, 2000);

        log("\n=== Tests Complete ===");
      }

      function log(message) {
        const logElement = document.getElementById("testLog");
        logElement.textContent += message + "\n";
        logElement.scrollTop = logElement.scrollHeight;
      }

      function clearLog() {
        document.getElementById("testLog").textContent = "";
      }
    </script>
  </body>
</html>
